<!DOCTYPE HTML>

<html>
    <head>
      
     <br>
      
      <div class="js-toggle-wrapper">
  <div class="js-toggle">
    <div class="js-toggle-track">
      <div class="js-toggle-track-check">
        <img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
          </div>
          <div class="js-toggle-track-x">
            <img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
              </div>
              </div>
              <div class="js-toggle-thumb"></div>
                <input class="js-toggle-screenreader-only" type="checkbox" aria-label="Switch between Dark and Light mode">
                  </div>
                  </div>
  
  <style>

 

.js-toggle-wrapper {
    display: table;
    margin: 0 auto;
}

.js-toggle {
    touch-action: pan-x;
    display: inline-block;
    position: relative;
    cursor: pointer;
    background-color: transparent;
    border: 0;
    padding: 0;
    -webkit-touch-callout: none;
    user-select: none;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    -webkit-tap-highlight-color: transparent;
  }
  
  .js-toggle-screenreader-only {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }
  
  .js-toggle-track {
    width: 50px;
    height: 24px;
    padding: 0;
    border-radius: 30px;
    background-color: hsl(222, 14%, 7%);
    transition: all 0.2s ease;
  }
  
  .js-toggle-track-check {
    position: absolute;
    width: 17px;
    height: 17px;
    left: 5px;
    top: 0px;
    bottom: 0px;
    margin-top: auto;
    margin-bottom: auto;
    line-height: 0;
    opacity: 0;
    transition: opacity 0.25s ease;
  }
  
  .js-toggle--checked .js-toggle-track-check {
    opacity: 1;
    transition: opacity 0.25s ease;
  }
  
  .js-toggle-track-x {
    position: absolute;
    width: 17px;
    height: 17px;
    right: 5px;
    top: 0px;
    bottom: 0px;
    margin-top: auto;
    margin-bottom: auto;
    line-height: 0;
    opacity: 1;
    transition: opacity 0.25s ease;
  }
  
  .js-toggle--checked .js-toggle-track-x {
    opacity: 0;
  }
  
  .js-toggle-thumb {
    position: absolute;
    top: 1px;
    left: 1px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background-color: #fafafa;
    box-sizing: border-box;
    transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1) 0ms;
    transform: translateX(0);
  }
  
  .js-toggle--checked .js-toggle-thumb {
    transform: translateX(26px);
    border-color: #19ab27;
  }
  
  .js-toggle--focus .js-toggle-thumb {
    box-shadow: 0px 0px 2px 3px rgb(255, 167, 196);
  }
  
  .js-toggle:active .js-toggle-thumb {
    box-shadow: 0px 0px 5px 5px rgb(255, 167, 196);
  }
  
  body.dark-mode , 
  body.dark-mode main * {
    background-color: #000000;
    color: #000000;
    filter: invert(0.95);
}

  .dark-mode img {
  filter: invert(1) contrast(1.3) saturate(1.4);
}

  .dark-mode p {
  color: #000000;
}
  
  .dark-mode code {
    filter: invert(1) contrast(1.3) saturate(1.4);
    font-weight: bold;
    background: #353737;
    color: white;
}

  .dark-mode strong, b {
    filter: invert(1) contrast(1.3) saturate(1.4);
  }
  
  .dark-mode #social-share ul{
    margin: 0;
    filter: invert(1) contrast(1.3) saturate(1.4);
  }

  .dark-mode #header {
    filter: invert(1) contrast(1.3) saturate(1.4);
    position: fixed;
  }

  .dark-mode .js-toggle--focus .js-toggle-thumb {
    filter: invert(1) contrast(1.3) saturate(1.4);
  }

  .dark-mode .footer {
    filter: invert(1) contrast(1.3) saturate(1.4);
    position: fixed;
    background-color: white;
    font-weight: bold;
  }

  .dark-mode .nav-secondary {
    filter: invert(1) contrast(1.3) saturate(1.4);
}

  .dark-mode #reactions .reaction-items .reaction-item .reaction-item__button img, #reactions-promotion .reaction-items .reaction-item .reaction-item__button img {
    filter: invert(1) contrast(1.3) saturate(1.4);
}

</style>

<script>
    var body = document.body;
    var article = document.article;
	var switcher = document.getElementsByClassName('js-toggle')[0];

	
	switcher.addEventListener("click", function() {
        this.classList.toggle('js-toggle--checked');
        this.classList.add('js-toggle--focus');
		
		if (this.classList.contains('js-toggle--checked')) {
			body.classList.add('dark-mode');
			article.classList.add('post.dark-mode');
			
			localStorage.setItem('darkMode', 'true');
		} else {
			body.classList.remove('dark-mode');
			article.classList.remove('post.dark-mode');
			setTimeout(function() {
				localStorage.removeItem('darkMode');
			}, 100);
		}
	})

	
	if (localStorage.getItem('darkMode')) {
		
        switcher.classList.add('js-toggle--checked');
        body.classList.add('dark-mode');
        article.classList.add('post.dark-mode');
	}

</script>


      
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/algotech.netlify.com\/"
        },
        "articleSection" : "blog",
        "name" : "Interpreting Text Classification Model with LIME",
        "headline" : "Interpreting Text Classification Model with LIME",
        "description" : "body { text-align: justify}  Introduction This article will focus on the implementation of LIME for interpreting text classification, since they are slightly different from common classification problem. We will cover the important points as clearly as possible. More detailed concept of LIME is available at my previous post .\nOne of many things to consider when we want to choose a machine learning model is the interpretability: can we analyze what variables or certain values that contribute toward particular class or target?",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-03-13 00:00:00 \u002b0000 UTC",
        "dateModified" : "2020-03-13 00:00:00 \u002b0000 UTC",
        "url" : "https:\/\/algotech.netlify.com\/blog\/text-lime\/",
        "wordCount" : "3377",
        "keywords" : [ "Machine Learning","Capstone Ml","lime","Blog" ]
    }
    </script>
        
            
                <title>Interpreting Text Classification Model with LIME</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.87.0" />
        
  
    
  

  

  <link rel="apple-touch-icon-precomposed" href='https://algotech.netlify.com/favicon/apple-touch-icon-precomposed.png'>
  <link rel="icon" href='https://algotech.netlify.com/favicon/favicon.png'>
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Algoritma Technical Blog">
  <meta name="msapplication-tooltip" content="To learn more about our approach to data science problems, feel free to hop over to our blog.">
  <meta name="msapplication-config" content='/favicon/ieconfig.xml'>



        
            <meta name="author" content="Arga Adyatama">
        
        
            
                <meta name="description" content="To learn more about our approach to data science problems, feel free to hop over to our blog.">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Interpreting Text Classification Model with LIME"/>
<meta name="twitter:description" content="body { text-align: justify}  Introduction This article will focus on the implementation of LIME for interpreting text classification, since they are slightly different from common classification problem. We will cover the important points as clearly as possible. More detailed concept of LIME is available at my previous post .
One of many things to consider when we want to choose a machine learning model is the interpretability: can we analyze what variables or certain values that contribute toward particular class or target?"/>
<meta name="twitter:site" content="@teamalgoritma"/>

        <meta property="og:title" content="Interpreting Text Classification Model with LIME" />
<meta property="og:description" content="body { text-align: justify}  Introduction This article will focus on the implementation of LIME for interpreting text classification, since they are slightly different from common classification problem. We will cover the important points as clearly as possible. More detailed concept of LIME is available at my previous post .
One of many things to consider when we want to choose a machine learning model is the interpretability: can we analyze what variables or certain values that contribute toward particular class or target?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://algotech.netlify.com/blog/text-lime/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-03-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-03-13T00:00:00+00:00" />


        <meta property="og:image" content="https://algotech.netlify.com//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Interpreting Text Classification Model with LIME">
<meta itemprop="description" content="body { text-align: justify}  Introduction This article will focus on the implementation of LIME for interpreting text classification, since they are slightly different from common classification problem. We will cover the important points as clearly as possible. More detailed concept of LIME is available at my previous post .
One of many things to consider when we want to choose a machine learning model is the interpretability: can we analyze what variables or certain values that contribute toward particular class or target?"><meta itemprop="datePublished" content="2020-03-13T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-03-13T00:00:00+00:00" />
<meta itemprop="wordCount" content="3377">
<meta itemprop="keywords" content="Machine Learning,Capstone Ml,lime," />
        

        
            
        

        
        
            <link disabled id="dark-mode-theme" rel="stylesheet" href="https://algotech.netlify.com/css/dark.css">
            <link rel="stylesheet" href="https://algotech.netlify.com/css/monokai-sublime.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://algotech.netlify.com/css/main.css">
            <link rel="stylesheet" href="https://algotech.netlify.com/css/add-on.css">
            <link rel="stylesheet" href="https://algotech.netlify.com/css/academicons.min.css">
            <link href="https://algotech.netlify.com/lib/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
            <link href="https://algotech.netlify.com/lib/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
            <link href="https://algotech.netlify.com/lib/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet">
            <link href="https://algotech.netlify.com/lib/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet">
        
            <link rel="stylesheet" href=
            "https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
                <link rel="stylesheet" href=
            "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
                      integrity=
            "sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" 
                      crossorigin="anonymous">
                <script src=
            "https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js">
                </script>
                <script src=
            "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js">
                </script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.0/js.cookie.js">
                </script>
                
                <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js">
                </script>
              
                <style>
                    
                     


                    .modal:before {
                        content: '';
                        display: inline-block;
                        height: 20%;
                        vertical-align: middle;
                    }
                      
                    .modal-dialog {
                        
                    display: -webkit-box;
                    display: -webkit-flex;
                    display: -ms-flexbox;
                    display: flex;
                    -webkit-box-orient: vertical;
                    -webkit-box-direction: normal;
                    -webkit-flex-direction: column;
                        -ms-flex-direction: column;
                            flex-direction: column;
                    -webkit-box-pack: center;
                    -webkit-justify-content: center;
                        -ms-flex-pack: center;
                            justify-content: center;
                    }

                      
                    .modal .modal-content {
                        padding: 20px 20px 20px 20px;
                        -webkit-animation-name: modal-animation;
                        -webkit-animation-duration: 0.5s;
                        animation-name: modal-animation;
                        animation-duration: 1.5s;
                    }

                

                    .modal .leadin-button {
                        -webkit-border-radius: 0.25em;
                        -moz-border-radius: 0.25em;
                        -ms-border-radius: 0.25em;
                        -o-border-radius: 0.25em;
                        border-radius: 0.25em;
                        -webkit-appearance: none;
                        cursor: pointer;
                        font-size: 1em;
                        font-weight: bold;
                        line-height: 1;
                        padding: 1em 1.5em;
                        width: 100%;
                        text-decoration: none;
                    }
                    .modal .leadin-button-primary {
                        background: #a90606 !important;
                        color: #FFFFFF !important;
                    }
                      
                    @-webkit-keyframes modal-animation {
                        from {
                            top: -100px;
                            opacity: 0;
                        }
                        to {
                            top: 0px;
                            opacity: 1;
                        }
                    }
                      
                    @keyframes modal-animation {
                        from {
                            top: -100px;
                            opacity: 0;
                        }
                        to {
                            top: 0px;
                            opacity: 1;
                        }
                    }
                </style>

            <script src="content/bootstrapJS/jquery-2.1.1.min.js" type="text/javascript"></script>

            <script type="text/javascript">
                
                
                $( document ).ready(function() {
  if (document.cookie.indexOf('visited=true') == -1){
    
                      $('#signupModal').modal('show');
    
                  var year = 1000*60*60*24*365;
    var expires = new Date((new Date()).valueOf() + year);
    document.cookie = "visited=true;expires=" + expires.toUTCString();

  }
}); 

            </script>
        
            

        
            
                
            
                
                    <link rel="stylesheet" href="https://algotech.netlify.com/css/main.css">
                
            
        


  
    
      <link rel="stylesheet" href="https://algotech.netlify.com/css/monokai-sublime.css" rel="stylesheet" id="theme-stylesheet">
      <script src="https://algotech.netlify.com/js/highlight.pack.js"></script>
      <script>hljs.initHighlightingOnLoad();</script>
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-164959107-2', 'auto');
	
	ga('send', 'pageview');
}
</script>



      
    </head>
    <body>

        <div class="modal" id="signupModal"
        role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
 
       <div class="modal-dialog">
           <div class="modal-content">
 
               
               <div class="m-header">
                   <button class="close" data-dismiss="modal">
                       ×
                   </button>
                   <h2 class="myModalLabel"> Upcoming Workshop! </h2>
               </div>
 
               
               <div class="inputs">
 
                <a href="https://algorit.ma/ds-course/dss-trading/?utm_source=algotech"><img src="https://algotech.netlify.com/img/2021/ads/dss_okt.png",
                     alt="Building Algorithmic Trading Dashboard", style="float: left; padding-right: 20px;" padding: 1px  width="30%" height="30%"></a>
                <p>This 3-day online workshop is a beginner-friendly introduction to algorithmic trading using the Python programming language. Throughout the online course, we will provide you with hands-on examples and a rich interactive experience. One Instructor and two Teaching Assistants will help you to troubleshoot or help with any difficulties encountered.</p>
                <div class="advance-wrapper callout-special-font">
                    <a href="https://algorit.ma/ds-course/dss-trading/?utm_source=algotech" target="_blank" 
                    class="leadin-button leadin-advance-button leadin-button-primary">LEARN MORE</a>
                </div>
               </div>
 
 
           </div>
       </div>
   </div>

    </body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="https://algotech.netlify.com/">blog</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="https://algotech.netlify.com/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="https://algotech.netlify.com/tags/machine-learning/">
                            <i class="fa fa-cog">&nbsp;</i>Machine Learning
                    </a>
                </li>
            
                <li>
                    <a href="https://algotech.netlify.com/tags/data-visualization/">
                            <i class="fa fa-area-chart">&nbsp;</i>Data Visualization
                    </a>
                </li>
            
                <li>
                    <a href="https://algotech.netlify.com/tags/">
                            <i class="fa fa-list">&nbsp;</i>Article List
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://algotech.netlify.com/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://algotech.netlify.com/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="https://algotech.netlify.com/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://algotech.netlify.com/tags/machine-learning/">
                            <h3>
                                <i class="fa fa-cog">&nbsp;</i>Machine Learning
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://algotech.netlify.com/tags/data-visualization/">
                            <h3>
                                <i class="fa fa-area-chart">&nbsp;</i>Data Visualization
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://algotech.netlify.com/tags/">
                            <h3>
                                <i class="fa fa-list">&nbsp;</i>Article List
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://algotech.netlify.com/blog/regression-arima-arimax/">Regression ARIMA (ARIMAX)</a></h3>
                                
                                <time class="published" datetime=
                                    '2021-09-09'>
                                    September 9, 2021</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://algotech.netlify.com/blog/hotel-forecast/">Multiple Hotel Segments Demand Forecasting</a></h3>
                                
                                <time class="published" datetime=
                                    '2021-07-30'>
                                    July 30, 2021</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://algotech.netlify.com/blog/advancing-your-shinyapp-ii/">Advancing Your Shiny Application II</a></h3>
                                
                                <time class="published" datetime=
                                    '2021-06-03'>
                                    June 3, 2021</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://algotech.netlify.com/blog/gridsearchcv/">GridSearchCV</a></h3>
                                
                                <time class="published" datetime=
                                    '2021-05-22'>
                                    May 22, 2021</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://algotech.netlify.com/blog/kemiripan-teks/">Pengenalan Kemiripan Teks (Text Similarity) di Python</a></h3>
                                
                                <time class="published" datetime=
                                    '2021-05-20'>
                                    May 20, 2021</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="https://twitter.com/intent/tweet?text=Interpreting%20Text%20Classification%20Model%20with%20LIME by Arga%20Adyatama&amp;url=https%3a%2f%2falgotech.netlify.com%2fblog%2ftext-lime%2f" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>








<li>
  <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2falgotech.netlify.com%2fblog%2ftext-lime%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>







<li>
  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2falgotech.netlify.com%2fblog%2ftext-lime%2f&amp;title=Interpreting%20Text%20Classification%20Model%20with%20LIME" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>











        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h2><a href="https://algotech.netlify.com/blog/text-lime/">Interpreting Text Classification Model with LIME</a></h2>
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2020-03-13'>
            March 13, 2020</time>
        <span class="author"><a href="https://github.com/Argaadya">Arga Adyatama</a></span>
        
            <p>16 minute read</p>
        
        
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        



<li>
  <a href="https://twitter.com/intent/tweet?text=Interpreting%20Text%20Classification%20Model%20with%20LIME by Arga%20Adyatama&amp;url=https%3a%2f%2falgotech.netlify.com%2fblog%2ftext-lime%2f" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>








<li>
  <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2falgotech.netlify.com%2fblog%2ftext-lime%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>







<li>
  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2falgotech.netlify.com%2fblog%2ftext-lime%2f&amp;title=Interpreting%20Text%20Classification%20Model%20with%20LIME" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>











      </ul>
    </section>
  

  
    

    
        
        







  
  
    
  


        
        
        

        <a href="https://algotech.netlify.com/blog/text-lime/" class="image featured">
            <img src="https://algotech.netlify.com/img/2020/03/lime.png" alt="">
        </a>
    


  <div id="content">
    


<style>
body {
text-align: justify}
</style>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This article will focus on the implementation of LIME for interpreting text classification, since they are slightly different from common classification problem. We will cover the important points as clearly as possible. More detailed concept of LIME is available at <a href = "https://algotech.netlify.com/blog/interpreting-classification-model-with-lime/"> my previous post </a>.</p>
<p>One of many things to consider when we want to choose a machine learning model is the interpretability: can we analyze what variables or certain values that contribute toward particular class or target? Some models can be easily interpreted, such as the linear or logistic regression model and decision trees, but interpreting more complex model such as random forest and neural network can be challenging. This sometimes drive the data scientist to choose more interpretable model since they need to communicate it to their manager or higher rank, who perhaps are not familiar with machine learning. The downside is, in general, interpretable model has lower performance in term of accuracy or precision, making them less useful and potentially dangerous for production. Therefore, there is a growing need on how to interpret a complex and black box model easily.</p>
<p>There exist a method called LIME, a novel explanation technique that explains the predictions of any classifier in an interpretable and faithful manner, by learning an interpretable model locally around the prediction. Here we will see how LIME works on text classification problem of user review. By understanding on how our model works, we can have more advantage and could act wiser on what should we do.</p>
<div id="library-and-setup" class="section level2">
<h2>Library and Setup</h2>
<p>Here is the list of required packages if you wish to reproduce the result.</p>
<pre class="r"><code># Data Wrangling
library(tidyverse)
library(tm)
library(tidytext)
library(textclean)
library(SnowballC)

# Model Fitting and Evaluation
library(caret)
library(e1071)

# Model Interpretation
library(lime)</code></pre>
</div>
</div>
<div id="use-case-steam-game-reviews" class="section level1">
<h1>Use Case: Steam Game Reviews</h1>
<p>For this topic, we will cover text mining application to predict customer perspective in Gaming industry. Gaming is a growing entertainment industry that can be enjoyed by everyone, from a little children to the elderly (see <a href = "https://www.youtube.com/channel/UCzkY7wa8Ksxv4M5NyUYgTmA"> a Grandma play Skyrim</a>). Gaming industry has estimated revenue of USD 43.3 Billions, surpassing global ticket sales of Box Office (USD 41.7 Billions) and streaming services (USD 28.8 Billions) in 2018<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>Video games come in many platform, such as Wii, Playstation, Xbox, or even in PC. One of the most lucrative gaming environment in PC is Steam, where people can purchase, discuss, or even create games. Many top ranked game are sold via Steam.</p>
<p>The question is, what a review have to do in Gaming industry? It turns out that a game review, especially an early access review, can heavily influence people to buy certain games<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. An early access review is a review that is give by people or organization that have played the game in the alpha or beta phase (the unfinished product). Some organization, such as the Polygon, PC Gamer, or Rock Paper Shotgun, has a role to assess and give critics to many games. There are also several individual that give game review and critics in their personal blog or Youtube Channel. They have many loyal reader that trust their reviews. Therefore, any critics given by them will become a great consideration for a player to buy a certain games. However, a review given at the full version release of the game is also important as well. Many late buyer or a skeptic people only buy a game after reading other people review after they play the game.</p>
<p>Through text mining, we can predict based on the given review that a user will give a recommendation toward a game. Further analyisis can be done by interpreting how the machine learning model works and interpret the result. For example, what words that will increase the probability for people to give recommendation, or what words that will drastically decrease the probability to give recommendation. Based on the result, we can formulate a new strategy and marketing planning for future improvement of the game, to make sure people will buy and stay loyal to our game.</p>
</div>
<div id="import-data" class="section level1">
<h1>Import Data</h1>
<p>The data is acquired from <a href = "https://www.kaggle.com/luthfim/steam-reviews-dataset"> Kaggle </a>. It contain reviews from Steam’s best selling games as February 2019.</p>
<pre class="r"><code>review &lt;- data.table::fread(&quot;data_input/steam_reviews.csv&quot;) %&gt;% 
  mutate(recommendation = as.factor(recommendation))

glimpse(review)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/glimpse.png" />
</center>
<p>Data description:</p>
<ul>
<li>date_posted: The date of posted review</li>
<li>funny: How many other player think the review is funny</li>
<li>helpful: How many other player think the review is helpful</li>
<li>hour_played: How many hour a reviewer play the game before make a review</li>
<li>is_early_access_review: Is the game on early access?</li>
<li>recommendation: Whether the user would recommend the game or not</li>
<li>review: User review</li>
<li>title: Title of the game</li>
</ul>
<div id="exploratory-data-analysis" class="section level3">
<h3>Exploratory Data Analysis</h3>
<p>Before we do model fitting, let’s check the proportion of recommendation based on whether the review is given at the early access or not.</p>
<pre class="r"><code>table(Is_early_access = review$is_early_access_review, 
      Recommend = review$recommendation) %&gt;% 
  prop.table() %&gt;% 
  addmargins()</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/proptable.png" />
</center>
<p>Based on the table, we can see that only 30% of the review come from the early access review. We can choose to only consider the early access review, but for now I will simply use all of the data.</p>
<p>Let’s check the class imbalance at the target variable.</p>
<pre class="r"><code>table(review$recommendation) %&gt;% 
  prop.table()</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/proptable2.png" />
</center>
<p>Many user tag a game as recommended, with only 30% consider a game is not recommended.</p>
</div>
<div id="cross-validation" class="section level3">
<h3>Cross-Validation</h3>
<p>Let’s split the data into training set and testing set with 75% of the data will be used as the training dataset.</p>
<pre class="r"><code>set.seed(123)
row_review &lt;- nrow(review)
index &lt;- sample(row_review, row_review*0.75)

data_train &lt;- review[ index, ]
data_test &lt;- review[ -index, ]</code></pre>
<p>Check the class proportion on the target variable.</p>
<pre class="r"><code>table(data_train$recommendation) %&gt;% 
  prop.table()</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/proptable3.png" />
</center>
<p>We will balance the data using down-sampling method. This will increase the model performance.</p>
<pre class="r"><code>set.seed(123)
data_train &lt;- downSample(x = data_train$review, 
                         y = data_train$recommendation, yname = &quot;recommendation&quot;)

table(data_train$recommendation) %&gt;% 
  prop.table()</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/proptable4.png" />
</center>
<p>Now we are ready to process the text data.</p>
</div>
</div>
<div id="text-mining-in-r" class="section level1">
<h1>Text Mining in R</h1>
<p>Text mining in R can be done in various way. There are some packages that support text processing. If you are new to text mining, I recommend you to read this <a href = "http://tidytextmining.com/"> wonderfull book </a>. On this article, we will use two approach: <code>tm</code> and a combination of <code>text_clean</code> and <code>tidytext</code>. The difference between the two approach is the preprocessing steps in handling the text data.</p>
<div id="using-tm-package" class="section level2">
<h2>Using <code>tm</code> package</h2>
<p>The first package that we will use is <code>tm</code> package.</p>
<div id="text-cleansing" class="section level3">
<h3>Text Cleansing</h3>
<p>We will create a corpus that contain the text review and cleanse the data</p>
<pre class="r"><code>review_corpus &lt;- VCorpus( VectorSource(data_train$x))

review_corpus &lt;- review_corpus %&gt;% 
  tm_map(content_transformer(tolower)) %&gt;% # lowercase
  tm_map(removeNumbers) %&gt;% # remove numerical character
  tm_map(removeWords, stopwords(&quot;english&quot;)) %&gt;%  # remove stopwords (and, the, am)
  tm_map(removePunctuation) %&gt;%  # remove punctuation mark
  tm_map(stemDocument) %&gt;%  # stem word (e.g. from walking to walk)
  tm_map(stripWhitespace) # strip double white space</code></pre>
</div>
<div id="document-term-matrix" class="section level3">
<h3>Document Term Matrix</h3>
<p>After we cleanse the text, now we will do tokenization: break a sentence or review into an individual words/terms and count the frequency at each document/review.</p>
<pre class="r"><code>train_dtm &lt;- DocumentTermMatrix(review_corpus)</code></pre>
<p>We have around 196K reviews with 136K unique terms/words.</p>
</div>
<div id="filter-terms" class="section level3">
<h3>Filter Terms</h3>
<p>Filter words that appear in at least 300 documents to shorten the computation time.</p>
<pre class="r"><code>freq &lt;- findFreqTerms(train_dtm, 300)
length(freq)

train_dtm &lt;- train_dtm[ , freq]</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/term.png" />
</center>
<p>We will only use 1584 terms to build the model. You may want to use more terms if you wish.</p>
</div>
<div id="bernoulli-converter" class="section level3">
<h3>Bernoulli Converter</h3>
<p>Convert the term frequency with bernoulli converter to account binary value (whether the terms present in the document or not).</p>
<pre class="r"><code>bernoulli_conv &lt;- function(x){
        x &lt;- factor(
          ifelse(x &gt; 0, 1, 0), levels = c(0,1), labels = c(&quot;Absent&quot;, &quot;Present&quot;)
          )
        return(x)}

# convert the document-term matrix  
train_x &lt;- apply(train_dtm, 2, bernoulli_conv)

# create the target variable
train_label &lt;- data_train$recommendation</code></pre>
</div>
<div id="model-fitting" class="section level3">
<h3>Model Fitting</h3>
<p>We will create a Naive Bayes model to predict the target variable based on the presence of each term. We also use laplace smoothing.</p>
<pre class="r"><code>model_bayes &lt;- naiveBayes(train_x, train_label, laplace = 1)</code></pre>
</div>
<div id="model-evaluation" class="section level3">
<h3>Model Evaluation</h3>
<p>Before we predict the data, let’s summarize the text preprocessing into a single function and store it as <code>tokenize_text()</code>. This function will be used to clean and tokenize the review from the testing dataset.</p>
<pre class="r"><code>tokenize_text &lt;- function(text){
  # Create Corpuse
  data_corpus &lt;- VCorpus(VectorSource(text))
  
  # Cleansing
  data_corpus_clean &lt;-  data_corpus %&gt;% 
    tm_map(content_transformer(tolower)) %&gt;% 
    tm_map(removeNumbers) %&gt;%
    tm_map(removeWords, stopwords(&quot;english&quot;)) %&gt;% 
    tm_map(removePunctuation) %&gt;% 
    tm_map(stemDocument) %&gt;% 
    tm_map(stripWhitespace) %&gt;% 
    tm_map(stemDocument)

  # Document-Term Matrix and use only terms from data train
  data_dtm &lt;- DocumentTermMatrix(data_corpus_clean, 
                                 control = list(dictionary = freq))

  # Bernoulli Converter
  data_text &lt;- apply(data_dtm, 2, bernoulli_conv)

  return(data_text)
}</code></pre>
<p>Now let’s predict the model performance.</p>
<pre class="r"><code>test_x &lt;- tokenize_text(data_test$review)
test_label &lt;- data_test$recommendation

pred_test &lt;- predict(model_bayes, test_x)

confusionMatrix(pred_test, test_label, positive = &quot;Recommended&quot;)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/confmat.png" />
</center>
<p>The model is quite good, with 73.6% accuracy, 85% Recall and 78% Precision.</p>
</div>
<div id="interpret-model-with-lime" class="section level3">
<h3>Interpret Model with LIME</h3>
<p>LIME is a great model that can interpret how our machine learning model (in this case, Naive Bayes) works and make prediction. In R, it come from <code>lime</code> package. However, LIME can only interpret model from several packages, including:</p>
<ul>
<li><code>caret</code></li>
<li><code>mlr</code></li>
<li><code>xgboost</code></li>
<li><code>h20</code></li>
<li><code>keras</code></li>
<li><code>MASS</code></li>
</ul>
<p>Our model comes from <code>naiveBayes()</code> function from <code>e1071</code> package, so by default they cannot be identified by <code>lime()</code>.</p>
<p>We have to create a support function for the <code>naiveBayes()</code> function in order to be interpreted by LIME. Let’s check the class of our model.</p>
<pre class="r"><code>class(model_bayes)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/classmodel.png" />
</center>
<p>We need to change the class of our model from <code>naiveBayes</code> to either <code>classification</code> or <code>regression</code> (depends on the problem). Since our case is a classification problem, we will change the model type into <code>classification</code> by creating a function.</p>
<p>You have to create a function named <code>model_type.</code> followed by the class of the model. In our model, the class is <code>naiveBayes</code>, so we need to create a function named <code>model_type.naiveBayes</code>.</p>
<pre class="r"><code>model_type.naiveBayes &lt;- function(x){
  return(&quot;classification&quot;)
}</code></pre>
<p>We also need a function to store the prediction. Same with the <code>model_type.</code>, we need to create a <code>predict_model.</code> followed by the class of our model. The function would be <code>predict_model.naiveBayes</code>. The content of the function is the function to predict the model. In Naive Bayes, the function is <code>predict()</code>. We need to return the probability value and convert them to <code>data.frame</code>, so the content would be <code>predict(x, newdata, type = "raw")</code> to return the probability of the prediction and convert them with <code>as.data.frame()</code>.</p>
<pre class="r"><code>predict_model.naiveBayes &lt;- function(x, newdata, type = &quot;raw&quot;) {

    # return classification probabilities only   
    res &lt;- predict(x, newdata, type = &quot;raw&quot;) %&gt;% as.data.frame()
    
    return(res)
}</code></pre>
<p>Now, we need to prepare the input for the lime. In common classification problem, the input can be the table that contain the features. However, in text classification, the input should be the original text and we also need to give the preprocessing step to process the text from cleansing to the tokenization. Make sure the input of the text is <code>character</code>, not a factor.</p>
<pre class="r"><code>text_train &lt;- data_train$x %&gt;% as.character() # The text review from data train

explainer &lt;- lime(text_train, # the input
                  model = model_bayes,  # the model 
                  preprocess = tokenize_text) # the preprocessing step</code></pre>
<p>Now we will try to explain how our model work on the test dataset. We will observe the interpretation of the 2nd to 5th obervations of the data test. Don’t forget to do <code>set.seed</code> to get reproducible example.</p>
<ul>
<li>The <code>n_labels</code> indicate how many label of target variable to be shown.</li>
<li>The <code>n_features</code> shows how many features will be used to explain the model. This parameter will be ignored if <code>feature_select = "none</code>.</li>
<li>The <code>feature_select</code> shows the feature selection method.</li>
<li><code>single_explanation</code> indicate logical whether to pool all text into a single review.</li>
</ul>
<pre class="r"><code>text_test &lt;- data_test$review

set.seed(123)
explanation &lt;- explain(text_test[2:5],
                       explainer = explainer, 
                       n_labels = 1, # show only 1 label (recommend or not recommend)
                       n_features = 5, 
                       feature_select = &quot;none&quot;, # use all terms to explain the model
                       single_explanation = F)</code></pre>
<p>Let’s visualize the result.</p>
<pre class="r"><code># visualize the interpretation
plot_text_explanations(explanation)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/lime1.png" />
</center>
<center>
<img src="https://algotech.netlify.com/img/text-lime/lime2.png" />
</center>
<p>Since the plot is run from a chunk, the output height and width of the plot is limited. If you want to scroll or see the complete plot, you need to run the <code>plot_text_explanations()</code> via the console.</p>
<p>We can see that for observations 2 (the first sentence), the probability to be not recommended is 100%. The explanation fit shows how good LIME at interpreting the prediction for this observation, which is only 27% so it may not that accurate. The blue-labeled text means that the word support/increase the probability to be not recommend, such as the word game, start or long time. The red-labeled text means that the word contradict/decrease the probability of the review to be recommended, such as fun, most infuriating or powerful.</p>
<p>The interpretation is not that good since the explanation fit is small, but at least we can derive some insight from it. We can also observe from the second sentenct that the word difficult, gast, and Materpiece contradict the probability to be not recommended.</p>
<p>A good example of great explanation fit is at the 3rd text (observation 4), with explanation fit of 80%. We can see that the word glitch, bug and error can support the review to be not recommended.</p>
</div>
</div>
<div id="using-textclean" class="section level2">
<h2>Using <code>textclean</code></h2>
<p>Another great package for text processing is <code>textclean</code> package. You can read more detail about it on <a href = "https://algotech.netlify.com/blog/textclean/"> our previous article </a>.</p>
<div id="data-preprocessing" class="section level3">
<h3>Data Preprocessing</h3>
<p>We will use the same data from the previous process. Using <code>text_clean</code>, we create a new column that contain the processed text that will be cleansed using various functions from the package.</p>
<pre class="r"><code>data_train &lt;- data_train %&gt;% 
  mutate(text_clean = x %&gt;% 
            str_to_lower() %&gt;% 
            replace_url() %&gt;%
            replace_money(replacement = &quot;&quot;) %&gt;% 
            replace_emoji() %&gt;% 
            replace_email() %&gt;% 
            replace_word_elongation() %&gt;% 
            replace_html() %&gt;% 
            replace_contraction() %&gt;% 
            replace_number(remove = T) %&gt;% 
            replace_date(replacement = &quot;&quot;) %&gt;% 
            str_remove_all(pattern = &quot;[[:punct:]]&quot;) %&gt;%
            str_squish() %&gt;% 
            str_trim()
           ) 

head(data_train, 10)</code></pre>
</div>
<div id="document-term-matrix-1" class="section level3">
<h3>Document-Term Matrix</h3>
<p>After we cleanse the data, next we will need to tokenize the data by converting it into document-term matrix.</p>
<pre class="r"><code>train_dtm &lt;- data_train %&gt;% 
  select(text_clean, recommendation) %&gt;% 
  rowid_to_column(&quot;id&quot;) %&gt;% 
  filter(is.na(text_clean) == F) %&gt;% 
  unnest_tokens(word, text_clean) %&gt;% 
  mutate(word = wordStem(word)) %&gt;% 
  anti_join(stop_words) %&gt;% 
  count(id, word) %&gt;% 
  cast_dtm(document = id, term = word, value = n)

inspect(train_dtm)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/dtm.png" />
</center>
<p>Let’s use terms that appear at least in 200 documents.</p>
<pre class="r"><code>train_term &lt;- findFreqTerms(train_dtm, 200)
length(train_term)</code></pre>
<p>Next we use bernoulli converter toward the document-term matrix. We will also get the train label.</p>
<pre class="r"><code># Filter the terms in DTM
train_dtm &lt;- train_dtm[ , train_term]

# Apply bernoulli converter
train_x &lt;- apply(train_dtm, 2, bernoulli_conv)

# Create train label
train_label &lt;- data_train %&gt;% 
  slice(  as.numeric(train_dtm$dimnames$Docs)) %&gt;% 
  pull(recommendation)</code></pre>
</div>
<div id="model-fitting-1" class="section level3">
<h3>Model Fitting</h3>
<p>We fit the data into the Naive Bayes model with laplace smoothing.</p>
<pre class="r"><code>model_bayes &lt;- naiveBayes(train_x, train_label, laplace = 1)</code></pre>
</div>
<div id="model-evaluation-1" class="section level3">
<h3>Model Evaluation</h3>
<p>Next, we evaluate the model to the testing dataset. We summarise the preprocessing step into a single function and store it as <code>tokenize_text()</code>.</p>
<pre class="r"><code>tokenize_text &lt;- function(text){
 clean_text &lt;-  text %&gt;% 
    str_to_lower() %&gt;% 
    replace_url() %&gt;% 
    replace_emoji() %&gt;%
    replace_email() %&gt;% 
    replace_word_elongation() %&gt;% 
    replace_html() %&gt;% 
    replace_contraction() %&gt;% 
    replace_number(remove = T) %&gt;% 
    replace_date() %&gt;% 
    str_remove_all(pattern = &quot;[[:punct:]]&quot;) %&gt;%
    str_squish() %&gt;% 
    str_trim()

  data_text &lt;- data.frame(text_clean = clean_text) %&gt;% 
    rowid_to_column(&quot;id&quot;) %&gt;% 
    filter(is.na(text_clean) == F) %&gt;% 
    mutate_all(as.character) %&gt;% 
    unnest_tokens(word, text_clean) %&gt;%  
    mutate(word = wordStem(word)) %&gt;% 
    filter(word %in% train_term) %&gt;% # Use only terms that appear in training set
    count(id, word) %&gt;% 
    cast_dtm(document = id, term = word, value = n) %&gt;% 
    apply(., 2, bernoulli_conv)
  
  return(data_text)
}

# tokenize text review
test_x &lt;- tokenize_text(data_test$review)

# get target variable
test_label &lt;- data_test %&gt;% 
  slice(  
    as.numeric( test_x %&gt;% rownames() )
    ) %&gt;% 
  pull(recommendation)</code></pre>
<p>After we prepare the data, now we will predict the target for the testing dataset and acquire the confusion matrix.</p>
<pre class="r"><code>pred_test &lt;- predict(model_bayes, test_x)

confusionMatrix(pred_test, test_label, positive = &quot;Recommended&quot;)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/confmat2.png" />
</center>
</div>
<div id="interpret-model-with-lime-1" class="section level3">
<h3>Interpret model with LIME</h3>
<p>To interpret the model with LIME, the step is similar to the one we’ve done by using the <code>tm</code> package. The difference is only the preprocessing step, <code>tokenize_text()</code>. To make the computation faster, we can adjust the number of permutations performed by lime through parameter <code>n_permutations</code>. On the following example, I use <code>n_permutations</code> of 10. Don’t forget to do <code>set.seed</code> to get reproducible example.</p>
<pre class="r"><code># Get text review from training set
train_text &lt;- data_train %&gt;% 
  slice(  
    as.numeric( train_x %&gt;% rownames() )
    ) %&gt;% 
  pull(x) %&gt;% as.character()

# Get text review from testing set
test_text &lt;- data_test$review

# Set explainer
explainer &lt;- lime(train_text, model_bayes, 
                  preprocess = tokenize_text)

set.seed(111)
explanation &lt;- explain(test_text[2:5],
                       explainer, n_labels = 1,
                       n_features = 5, 
                       n_permutations = 10, # Adjust the number of permutation
                       feature_select = &quot;none&quot;, 
                       single_explanation = F)</code></pre>
<p>Let’s visualize the result.</p>
<pre class="r"><code># Plot the visualization
plot_text_explanations(explanation)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/lime3.png" />
</center>
<center>
<img src="https://algotech.netlify.com/img/text-lime/lime4.png" />
</center>
</div>
</div>
</div>
<div id="error-and-troubleshoot" class="section level1">
<h1>Error and Troubleshoot</h1>
<p>This section is dedicated to give some insight from potential <code>error</code> that you might find when using <code>lime</code>.</p>
<div id="response-is-constant-across-permutations" class="section level2">
<h2>Response is constant across permutations</h2>
<p>You may wonder why we don’t insert the first observation of the review to the explanation. Let’s check the review content.</p>
<pre class="r"><code>data_test$review[1]</code></pre>
<p>The review containt only the word “yes”. We will try to explain it with LIME. Since the <code>explainer</code> expect a matrix, we need to insert at least 2 observations, so will go with the first and the second observation.</p>
<pre class="r"><code>set.seed(123)
explanation &lt;- explain(test_text[1:2],
                       explainer = explainer, 
                       n_labels = 1, # show only 1 label (recommend or not recommend)
                       n_features = 5, 
                       n_permutations = 10,
                       feature_select = &quot;none&quot;, # use all terms to explain the model
                       single_explanation = F)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/error.png" />
</center>
<p>We get an error, with message <code>Error: Response is constant across permutations. Please check your model</code>. One of many reason it throws an error is because the input for our model is a document-term matrix, with many sparse/empty values. LIME don’t work really with an input that contain many sparse value like in text classification<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. With the text contain only the word <code>yes</code>, the matrix will be 0 (Absent) or sparse for most of the feature and 1 (Present) for a single feature, that is the term <code>yes</code>. So, whenever you found an error like this, you can be certain that the input is a matrix with empty values. To my best knowledge, there is no workaround for this problem yet. Therefore, we only concern with a review or text that contain several words.</p>
</div>
<div id="predicted_label-is-not-a-string-a-length-one-character-vector" class="section level2">
<h2>Predicted_label is not a string (a length one character vector)</h2>
<p>If we want to use the <code>plot_text_explanations()</code>, the <code>n_labels</code> should always be 1, meaning that we can only display output for 1 label or target value, either the <code>Recommended</code> or <code>Not Recommended</code>. If you force the explainer to include 2 labels, it will give an error like the following.</p>
<pre class="r"><code>set.seed(123)
explanation &lt;- explain(test_text[2:3],
                       explainer = explainer, 
                       n_labels = 2, # show 2 label (recommend or not recommend)
                       n_features = 5, 
                       n_permutations = 10,
                       feature_select = &quot;none&quot;, # use all terms to explain the model
                       single_explanation = F)

plot_text_explanations(explanation)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/error2.png" />
</center>
</div>
<div id="incorrect-number-of-predictions" class="section level2">
<h2>Incorrect number of predictions</h2>
<p>Whenever you find an error, you can look at the cause of the error by using <code>traceback()</code> function. Here is another example of error.</p>
<pre class="r"><code>set.seed(123)
explanation &lt;- explain(test_text[2:4],
                       explainer = explainer, 
                       n_labels = 1, # show only 1 label (recommend or not recommend)
                       n_features = 5, 
                       n_permutations = 10,
                       feature_select = &quot;none&quot;, # use all terms to explain the model
                       single_explanation = F)</code></pre>
<center>
<img src="https://algotech.netlify.com/img/text-lime/error3.png" />
</center>
<pre class="r"><code>traceback()</code></pre>
<p>The <code>traceback()</code> will return the following result.</p>
<pre class="r"><code># 4: stop(assertError(attr(res, &quot;msg&quot;)))
# 3: assert_that(nrow(case_res) == length(case_perm$permutations), 
#        msg = &quot;Incorrect number of predictions&quot;)
# 2: explain.character(test_text[2:4], explainer, n_labels = 1, n_features = 5, 
#        n_permutations = 10, feature_select = &quot;none&quot;, single_explanation = F)
# 1: explain(test_text[2:4], explainer, n_labels = 1, n_features = 5, 
#        n_permutations = 10, feature_select = &quot;none&quot;, single_explanation = F)</code></pre>
<p>Based on the traceback result, <code>explain()</code> is error because the number of row for the predicted values (<code>case_res</code>) is not the same with the length of the permutation (<code>case_perm$permutations</code>). You can check the <a href = "https://github.com/thomasp85/lime/blob/master/R/character.R"> source code </a>) to see what really happened, but based on the error, the permutation failed to produce a prediction, therefore we have less number of prediction compared to the number of permutation. Since a permutation is a sampling problem, for temporary solution you can handle the problem by changing the <code>seed</code> for the explanation or simply change the number of permutation via <code>n_permutations</code>.</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>LIME is very useful to help us understand how our model works not only in a common classification problem with the feature presented in tabular format, but it can also interpret how the model work by looking at the text-formatted input. The important point of using <code>lime</code> is you have to define how the text is preprocessed until it can become a matrix as the input for the model. I also have shown you several errors that may shows up when you try to use LIME.</p>
</div>
<div id="reference" class="section level1">
<h1>Reference</h1>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://techcrunch.com/2019/01/22/video-game-revenue-tops-43-billion-in-2018-an-18-jump-from-2017/">Video game revenue tops $43 billion in 2018, an 18% jump from 2017</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p><a href="https://cs-agents.com/blog/game-review-affect-game-purchases/">Does a Game Review Heavily Affect Game Purchases?</a><a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p><a href="https://stackoverflow.com/questions/51084343/root-cause-and-resolve-an-error-returned-rs-lime-librarys-explain-functio">Response is constant across permutations</a><a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</div>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="https://algotech.netlify.com/categories/r">R</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="https://algotech.netlify.com/tags/machine-learning">Machine Learning</a></li>
                
                
                <li><a class="article-category-link" href="https://algotech.netlify.com/tags/capstone-ml">Capstone Ml</a></li>
                
                
                <li><a class="article-category-link" href="https://algotech.netlify.com/tags/lime">lime</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-algotech-netlify-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="https://algotech.netlify.com/blog/dbscan-clustering/"
                class="button big previous">DBSCAN Clustering</a></li>
    

    
        <li><a href="https://algotech.netlify.com/blog/text-generating-with-markov-chains/"
                class="button big next">Text Generation with Markov Chains</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='https://algotech.netlify.com/'><img src="https://algotech.netlify.com/img/main/logo.png" class="intro-circle" width="30%" alt="Hugo Future Imperfect" /></a>
      
    
    
      <header>
        <h2>Algoritma Technical Blog</h2>
        <p>We're a group of people who teach data science to individuals, trains companies and their employees to better profit from data. We care about the development of data science and a sense of community that connects our alumni and team with one another. To learn more about our approach to data science problems, feel free to hop over to our blog.</p>
      </header>
    
    
      <ul class="icons">
        
        
  <li><a href="//github.com/teamalgoritma" target="_blank" title="GitHub" class="fa fa-github"></a></li>



























  <li><a href="//linkedin.com/company/teamalgoritma" target="_blank" title="LinkedIn Company" class="fa fa-linkedin"></a></li>









  <li><a href="//facebook.com/teamalgoritma" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>





















  <li><a href="//instagram.com/teamalgoritma" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>





  <li><a href="//twitter.com/teamalgoritma" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Upcoming Workshop</h3>
      </header>
      <div class="posts-container">
          <article class="mini-post">
            <header>
              
              
              <h3>
                <a href="https://algorit.ma/ds-course/dss-trading/?utm_source=algotech"><img src="https://algotech.netlify.com/img/2021/ads/dss_okt.png", alt="Building Algorithmic Trading Dashboard",  width="270" height="340">More details</a>
              </h3>
              
              <h3>
                <a href="https://algorit.ma/dds-oil-gas/?utm_source=algotech"><img src="https://algotech.netlify.com/img/2021/ads/dds-oilgas.png", alt="DDS: Secrets to a Successful Analytics Project in the Oil and Gas Industry",  width="270" height="340">More details</a>
              </h3>
            </header>
          </article>
      </div>

      
      
    </div>
  </section>

  
  
  

  
  

  
  <section id="footer">
    <p class="copyright">
      
        &copy; 2021
        
          Algoritma Technical Blog
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    <style>
      .footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        height:50px; 
        background-color: black;
        color: white;
        text-align: center;
        padding-top: 15px;
        padding-bottom: 15px;
        padding-left: 50px;
        padding-right: 50px;
}
      }


      </style>

      <div class="footer">
        <p>
          Want to know more about our workshop?
          <a href="https://algorit.ma/?utm_source=algotech&utm_medium=content&utm_campaign=text-lime" style="color: rgb(197, 38, 38)"> Visit our main website here</a> <br>
        </p>
          
      </div>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://algotech.netlify.com/js/util.js"></script>
      <script src="https://algotech.netlify.com/js/main.js"></script>
      <script src="https://algotech.netlify.com/js/backToTop.js"></script>
    

    
      
        
      
        
          <script src="https://algotech.netlify.com/js/bootstrap.min.js"></script>
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

